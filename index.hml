<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Malla Curricular Psicología (USS) — 2022</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f6f8fb;
    --card:#ffffff;
    --muted:#6b7280;
    --accent:#6aa7c8;
    --accent-2:#cfeefb;
    --ok:#7ad29a;
    --lock:#d6dde3;
    --glass: rgba(255,255,255,0.6);
    font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;}
  body{
    margin:0;
    padding:20px;
    background: linear-gradient(180deg, #f8fbfd 0%, var(--bg) 100%);
    color:#123;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:16px;
    margin-bottom:14px;
  }
  h1{font-size:20px;margin:0;}
  p.lead{margin:4px 0 0;color:var(--muted);font-size:13px}

  .controls{display:flex;gap:8px;align-items:center}
  button, .btn{
    background:var(--card);
    border:1px solid rgba(18,24,35,0.06);
    padding:8px 12px;
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
  }
  button.secondary{background:transparent;border:1px solid #e6eef4;color:var(--muted)}
  .grid{
    display:grid;
    grid-template-columns: repeat(10, 1fr);
    gap:12px;
    align-items:start;
    margin-top:18px;
  }

  .col{
    background: linear-gradient(180deg, rgba(255,255,255,0.7), var(--card));
    border-radius:12px;
    padding:10px;
    min-height:160px;
    box-shadow: 0 6px 18px rgba(10,20,30,0.04);
    border:1px solid rgba(18,24,35,0.03);
  }
  .col h3{font-size:13px;margin:0 0 8px;color:var(--muted);font-weight:600}
  .course{
    background:transparent;
    border-radius:8px;
    padding:8px;
    margin-bottom:8px;
    display:flex;
    gap:8px;
    align-items:center;
    justify-content:space-between;
    cursor:pointer;
    transition:all .18s ease;
    position:relative;
    border:1px dashed transparent;
  }
  .course:hover{transform:translateY(-2px)}
  .course .left{display:flex;gap:8px;align-items:center}
  .dot{width:10px;height:10px;border-radius:50%;background:var(--accent-2);flex-shrink:0;border:2px solid rgba(0,0,0,0.04)}
  .course .title{font-size:13px}
  .course .meta{font-size:11px;color:var(--muted);margin-left:6px}

  .approved{
    background: linear-gradient(90deg, rgba(122,210,154,0.12), rgba(122,210,154,0.06));
    border:1px solid rgba(122,210,154,0.18);
    box-shadow: inset 0 -6px 12px rgba(122,210,154,0.02);
  }
  .locked{
    opacity:0.6;
    pointer-events:auto;
  }
  .lock-overlay{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(180deg, rgba(255,255,255,0.0), rgba(255,255,255,0.65));
    border-radius:8px;
    pointer-events:none;
  }

  .course .state{
    font-size:12px;
    padding:5px 8px;
    border-radius:999px;
    background:var(--glass);
    display:inline-flex;
    gap:6px;
    align-items:center;
  }
  .tooltip{
    position:absolute;
    z-index:40;
    background:#0b1220;
    color:white;
    font-size:12px;
    padding:8px;
    border-radius:8px;
    top:calc(100% + 8px);
    left:0;
    white-space:nowrap;
    transform-origin:top left;
    box-shadow:0 10px 30px rgba(2,6,23,0.3);
    display:none;
  }
  .course.locked:hover .tooltip{display:block}

  .legend{margin-top:12px;display:flex;gap:12px;align-items:center;color:var(--muted);font-size:13px}
  .chip{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;background:var(--card);border:1px solid rgba(18,24,35,0.04)}

  footer{margin-top:14px;color:var(--muted);font-size:13px}
  .small{font-size:12px;color:var(--muted)}
  pre{white-space:pre-wrap;word-break:break-word;background:transparent;border-radius:8px;padding:8px}
  /* responsive */
  @media (max-width:1100px){
    .grid{grid-template-columns: repeat(5,1fr)}
  }
  @media (max-width:700px){
    .grid{grid-template-columns: repeat(2,1fr)}
  }
</style>
</head>
<body>
<header>
  <div>
    <h1>Malla Curricular — Psicología (USS) Plan 2022</h1>
    <p class="lead">Semestres 1 → 10 — Marca las asignaturas aprobadas. El progreso se guarda en tu navegador.</p>
  </div>
  <div class="controls">
    <button id="reset">Reset progreso</button>
    <button id="export">Exportar JSON</button>
    <button id="importBtn" class="secondary">Importar JSON</button>
    <input id="importFile" type="file" accept="application/json" style="display:none"/>
  </div>
</header>

<section>
  <div class="grid" id="grid">
    <!-- columnas se inyectan por JS -->
  </div>

  <div class="legend">
    <div class="chip"><span style="width:10px;height:10px;border-radius:50%;background:var(--accent);display:inline-block"></span> Materia disponible</div>
    <div class="chip"><span style="width:10px;height:10px;border-radius:50%;background:var(--ok);display:inline-block"></span> Aprobada</div>
    <div class="chip"><span style="width:10px;height:10px;border-radius:50%;background:var(--lock);display:inline-block"></span> Bloqueada (prerrequisitos)</div>
  </div>

  <footer>
    <p class="small">Nota: los prerrequisitos fueron inferidos a partir de la secuencia de la malla. Si deseas ajustes específicos, puedo editar la lista de prerrequisitos directamente en el archivo. (Fuente: malla subida). :contentReference[oaicite:1]{index=1}</p>
  </footer>
</section>

<script>
/* --------------------------------------------------------
  Datos de la malla: semestres 1..10 con asignaturas.
  Cada asignatura tiene: id, title, prereqs (lista de ids)
  Prerrequisitos inferidos manualmente (edítalos si quieres).
---------------------------------------------------------*/
const SEMESTERS = [
  {num:1, title:"Semestre 1", courses:[
    {id:"s1_estrategias", title:"Estrategias para el Aprendizaje Integral I"},
    {id:"s1_evolucion", title:"Evolución Histórica de la Psicología"},
    {id:"s1_intro_psico", title:"Introducción a la Psicoterapia Psicoanalítica"},
    {id:"s1_fund_bio", title:"Fundamentos Biológicos de Comportamiento"},
    {id:"s1_antropologia", title:"Antropología"}
  ]},
  {num:2, title:"Semestre 2", courses:[
    {id:"s2_etica", title:"Ética"},
    {id:"s2_intro_met", title:"Introducción a la Metodología de la Investigación"},
    {id:"s2_psic_evol1", title:"Psicología Evolutiva I"},
    {id:"s2_psic_social1", title:"Psicología Social I"},
    {id:"s2_procesos_cogn", title:"Procesos Cognitivos"}
  ]},
  {num:3, title:"Semestre 3", courses:[
    {id:"s3_electivo_f1", title:"Electivo de Formación Integral I"},
    {id:"s3_metodologia_apl", title:"Metodología de la Investigación Aplicada a la Psicología", prereqs:["s2_intro_met"]},
    {id:"s3_analisis_cuant", title:"Análisis de datos Cuantitativos", prereqs:["s2_intro_met"]},
    {id:"s3_procesos_afec", title:"Procesos Afectivos"},
    {id:"s3_teorias1", title:"Teorías Psicológicas I"}
  ]},
  {num:4, title:"Semestre 4", courses:[
    {id:"s4_electivo_f2", title:"Electivo de Formación Integral II"},
    {id:"s4_neuro", title:"Neuropsicología", prereqs:["s1_fund_bio"]},
    {id:"s4_psico_evol2", title:"Psicología Evolutiva II", prereqs:["s2_psic_evol1"]},
    {id:"s4_analisis_cual", title:"Análisis de datos Cualitativos"},
    {id:"s4_teorias2", title:"Teorías Psicológicas II"}
  ]},
  {num:5, title:"Semestre 5", courses:[
    {id:"s5_electivo_f3", title:"Electivo de Formación Integral III"},
    {id:"s5_intro_psic_cog", title:"Introducción a la Psicoterapia Cognitiva"},
    {id:"s5_psicopat_infantil", title:"Psicopatología y Psiquiatría Infantil", prereqs:["s3_procesos_afec","s3_teorias1"]},
    {id:"s5_psic_social2", title:"Psicología Social II"},
    {id:"s5_taller_persona", title:"Taller Persona del Psicólogo"}
  ]},
  {num:6, title:"Semestre 6", courses:[
    {id:"s6_electivo_f4", title:"Electivo de Formación Integral IV"},
    {id:"s6_psicopat_adulto", title:"Psicopatología y Psiquiatría Adulto", prereqs:["s5_psicopat_infantil"]},
    {id:"s6_gestion", title:"Gestión de Personas y Organizaciones"},
    {id:"s6_analisis_datos2", title:"Análisis de datos avanzados (seminar)", prereqs:["s3_analisis_cuant"]},
    {id:"s6_eval_cog", title:"Evaluación Psicológica Cognitiva"}
  ]},
  {num:7, title:"Semestre 7", courses:[
    {id:"s7_eval_person", title:"Evaluación Psicológica de la Personalidad", prereqs:["s6_eval_cog"]},
    {id:"s7_intro_sist", title:"Introducción a la Psicoterapia Sistémica"},
    {id:"s7_introd_human", title:"Introducción a la Psicoterapia Humanista"},
    {id:"s7_comport_org", title:"Comportamiento Organizacional"},
    {id:"s7_electivo_design", title:"Electivo I Diseño e Intervención"}
  ]},
  {num:8, title:"Semestre 8", courses:[
    {id:"s8_eval_integrada", title:"Evaluación Psicológica Integrada", prereqs:["s7_eval_person"]},
    {id:"s8_practica_prof", title:"Práctica Profesional", prereqs:["s7_eval_person"]},
    {id:"s8_taller_entrevista", title:"Taller de Entrevista"},
    {id:"s8_integracion", title:"Integración en Psicología"},
    {id:"s8_electivo_design2", title:"Electivo II Diseño en Contextos"}
  ]},
  {num:9, title:"Semestre 9", courses:[
    {id:"s9_seminario_inv", title:"Seminario de Investigación", prereqs:["s3_analisis_cuant","s3_metodologia_apl"]},
    {id:"s9_proyecto_inv", title:"Proyecto de Investigación", prereqs:["s9_seminario_inv"]},
    {id:"s9_politicas", title:"Políticas Públicas"},
    {id:"s9_problemas_psicosoc", title:"Problemas Psicosociales Actuales"},
    {id:"s9_taller_comun", title:"Taller de Comunicación"}
  ]},
  {num:10, title:"Semestre 10", courses:[
    {id:"s10_electivo_esp1", title:"Electivo de Especialización I"},
    {id:"s10_electivo_esp2", title:"Electivo de Especialización II"},
    {id:"s10_electivo_esp3", title:"Electivo de Especialización III"},
    {id:"s10_proyecto_final", title:"Proyecto de Investigación Final", prereqs:["s9_proyecto_inv","s8_practica_prof"]},
    {id:"s10_taller_trabajo", title:"Taller de Trabajo Grupal"}
  ]}
];

/* localStorage key */
const STORAGE_KEY = "malla_psicologia_uss_2022_states_v1";

/* create a course lookup for easy access */
const courseLookup = {};
SEMESTERS.forEach(sem=>{
  sem.courses.forEach(c=>{
    courseLookup[c.id] = {...c, semester: sem.num};
  });
});

/* load saved state (approved ids set) */
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return {};
    return JSON.parse(raw);
  }catch(e){ console.warn("Error parsing state",e); return {}; }
}

/* save state */
function saveState(state){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

/* check if all prereqs approved */
function isUnlocked(courseId, state){
  const course = courseLookup[courseId];
  if(!course) return true;
  const prereqs = course.prereqs || [];
  for(const p of prereqs){
    if(!state[p]) return false;
  }
  return true;
}

/* get missing prereq titles */
function missingPrereqs(courseId, state){
  const course = courseLookup[courseId];
  if(!course) return [];
  const prereqs = course.prereqs || [];
  return prereqs.filter(p => !state[p]).map(p => (courseLookup[p] && courseLookup[p].title) || p);
}

/* render grid */
function render(){
  const container = document.getElementById("grid");
  container.innerHTML = "";
  const state = loadState();
  SEMESTERS.forEach(sem=>{
    const col = document.createElement("div");
    col.className = "col";
    col.innerHTML = `<h3>${sem.title}</h3>`;
    sem.courses.forEach(course=>{
      const approved = !!state[course.id];
      const unlocked = isUnlocked(course.id, state);
      const card = document.createElement("div");
      card.className = "course";
      if(approved) card.classList.add("approved");
      if(!unlocked) card.classList.add("locked");
      card.dataset.id = course.id;
      card.setAttribute("role","button");
      // left content
      const left = document.createElement("div");
      left.className = "left";
      left.innerHTML = `<span class="dot" aria-hidden="true"></span>
                        <div>
                          <div class="title">${course.title}</div>
                          <div class="meta">Sem ${sem.num}</div>
                        </div>`;
      const right = document.createElement("div");
      right.className = "right";
      right.innerHTML = `<div class="state">${approved ? "Aprobada" : (unlocked ? "Disponible" : "Bloqueada")}</div>`;

      card.appendChild(left);
      card.appendChild(right);

      /* tooltip for locked */
      if(!unlocked){
        const tip = document.createElement("div");
        tip.className = "tooltip";
        const missing = missingPrereqs(course.id,state);
        tip.innerHTML = `<strong>Faltan:</strong> ${missing.join(", ")}`;
        card.appendChild(tip);
        // overlay small lock icon
        const overlay = document.createElement("div");
        overlay.className = "lock-overlay";
        overlay.innerHTML = `<div style="display:flex;gap:8px;align-items:center;color:var(--muted)"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="opacity:.7" xmlns="http://www.w3.org/2000/svg"><path d="M17 10V8a5 5 0 0 0-10 0v2" stroke="#435b6c" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><rect x="3" y="10" width="18" height="11" rx="2" stroke="#435b6c" stroke-width="1.4"/></svg><span style="font-size:13px;color:var(--muted)">Bloqueada</span></div>`;
        card.appendChild(overlay);
      }

      /* click handler */
      card.addEventListener("click", (ev)=>{
        ev.preventDefault();
        const id = card.dataset.id;
        const current = loadState();
        if(!isUnlocked(id, current)){
          // do nothing but show pulse feedback
          card.animate([{transform:"scale(1)"},{transform:"scale(0.98)"},{transform:"scale(1)"}],{duration:180});
          return;
        }
        // toggle approved
        if(current[id]){
          delete current[id];
        }else{
          current[id] = true;
        }
        saveState(current);
        render(); // re-render to update locks and tooltips
      });

      col.appendChild(card);
    });
    container.appendChild(col);
  });
}

/* reset button */
document.getElementById("reset").addEventListener("click", ()=>{
  if(confirm("¿Borrar todo el progreso guardado?")) {
    localStorage.removeItem(STORAGE_KEY);
    render();
  }
});

/* export */
document.getElementById("export").addEventListener("click", ()=>{
  const state = loadState();
  const blob = new Blob([JSON.stringify(state,null,2)],{type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "malla_psicologia_uss_2022_progress.json";
  a.click();
  URL.revokeObjectURL(url);
});

/* import */
const importFile = document.getElementById("importFile");
document.getElementById("importBtn").addEventListener("click", ()=> importFile.click());
importFile.addEventListener("change", async (e)=>{
  const f = e.target.files[0];
  if(!f) return;
  const txt = await f.text();
  try {
    const parsed = JSON.parse(txt);
    // validate: should be object with bools
    if(typeof parsed !== "object") throw new Error("Formato inválido");
    localStorage.setItem(STORAGE_KEY, JSON.stringify(parsed));
    alert("Progreso importado correctamente.");
    render();
  } catch(err){
    alert("Error al importar: formato JSON inválido.");
  }
  importFile.value = "";
});

/* initial render */
render();

/* Expose for console editing if needed */
window.Malla = {SEMESTERS, courseLookup, STORAGE_KEY};
</script>
</body>
</html>
